<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Welcome to the meta world</title>

    <!-- Babylon.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
    <script src="https://cdn.babylonjs.com/ammo.js"></script>
    <script src="https://cdn.babylonjs.com/havok/HavokPhysics_umd.js"></script>
    <script src="https://cdn.babylonjs.com/cannon.js"></script>
    <script src="https://cdn.babylonjs.com/Oimo.js"></script>
    <script src="https://cdn.babylonjs.com/earcut.min.js"></script>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://cdn.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://cdn.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://cdn.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

    <style>
      html,
      body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #renderCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
      }

      #canvasZone {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="canvasZone"><canvas id="renderCanvas"></canvas></div>
    <script>
      // get canvas
      var canvas = document.getElementById("renderCanvas");

      // create Babylon.js engine
      var engine = new BABYLON.Engine(canvas, true);

      // create Babylon.js scene
      var scene = new BABYLON.Scene(engine);
      scene.clearColor = new BABYLON.Color4.FromHexString("#F47373");

      // create camera
      var camera = new BABYLON.ArcRotateCamera(
        "Camera",
        BABYLON.Tools.ToRadians(270),
        BABYLON.Tools.ToRadians(50),
        340,
        BABYLON.Vector3.Zero(),
        scene
      );

      // 최소 줌 거리 설정
      camera.lowerRadiusLimit = 5;

      // 최대 줌 거리 설정
      camera.upperRadiusLimit = 350;

      camera.attachControl(canvas, true);

      // Add hemispheric light to the scene
      var hemiLight = new BABYLON.HemisphericLight(
        "hemiLight",
        new BABYLON.Vector3(0, 1, 0),
        scene
      );
      hemiLight.intensity = 0.5;
      hemiLight.diffuse = new BABYLON.Color4.FromHexString("#212568");

      // Add point light to the scene
      var pointLight = new BABYLON.PointLight(
        "pointLight",
        new BABYLON.Vector3(0, 1, 0),
        scene
      );
      pointLight.intensity = 0.6;
      pointLight.diffuse = new BABYLON.Color4.FromHexString("#FFFFBC");

      // Add spotlight to the scene
      var spotLight = new BABYLON.SpotLight(
        "spotLight",
        new BABYLON.Vector3(0, 20, 0),
        new BABYLON.Vector3(0, -1, 0),
        BABYLON.Tools.ToRadians(30),
        0,
        scene
      );
      spotLight.intensity = 0.6;
      spotLight.diffuse = new BABYLON.Color4.FromHexString("#FF400");

      // // Add shadow generator to the point light
      // var shadowGenerator = new BABYLON.ShadowGenerator(1024, pointLight);
      // shadowGenerator.usePoissonSampling = true;
      // shadowGenerator.bias = 0.01;
      // shadowGenerator.normalBias = 0.02;
      // shadowGenerator.darkness = 0.5;

      // load glb file as ground
      BABYLON.SceneLoader.ImportMesh(
        "",
        "",
        "Island_20.glb",
        scene,
        function (newMeshes) {
          // access the first mesh in the returned array
          var ground = newMeshes[0];

          // apply scaling and position to the ground mesh
          ground.scaling = new BABYLON.Vector3(10, 10, 10);
          ground.position = new BABYLON.Vector3(5, 0, 0);

          // enable shadows for the ground mesh
          ground.receiveShadows = true;

          // enable collisions for the ground mesh
          var groundMaterial = new BABYLON.StandardMaterial(
            "groundMaterial",
            scene
          );
          groundMaterial.diffuseColor = new BABYLON.Color3(1, 0, 0);
          groundMaterial.alpha = 0.5;
          groundMaterial.wireframe = true;
          ground.material = groundMaterial;
          ground.receiveShadows = true;
          BABYLON.SceneLoader.ImportMesh(
            "",
            "",
            "dog.glb",
            scene,
            function (newMeshes, particleSystems, skeletons, animationGroups) {
              var pet = newMeshes[0];
              // 콜백 함수 내부에서 새로운 메시(mesh)의 위치를 조정할 수 있습니다.
              pet.position = new BABYLON.Vector3(5, 11, 0);
              pet.rotation = new BABYLON.Vector3(0, 4, 0);
              pet.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
              pet.receiveShadows = true;

              // //Scale the model down
              // pet.scaling.scaleInPlace(0.1);

              //Lock camera on the character
              camera.target = pet;

              //Get the Samba animation Group
              const walkAnim = scene.getAnimationGroupByName("Walk");

              //Play the Samba animation
              walkAnim.start(true, 1.0, walkAnim.from, walkAnim.to, false);
            }
          );

          // start rendering loop
          engine.runRenderLoop(function () {
            scene.render();
          });
        }
      );
    </script>
  </body>
</html>
